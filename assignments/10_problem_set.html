<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-11-30">

<title>Gov 2002 - Gov 2002: Problem Set 10</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../files/img/gov2002-shield.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Gov 2002</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../materials/index.html" rel="" target="">
 <span class="menu-text">Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../assignments/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://edstem.org/us/courses/45093/discussion/" rel="" target="">
 <span class="menu-text">Ed</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.gradescope.com/courses/589033" rel="" target="">
 <span class="menu-text">Gradescope</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../assignments/01_problem_set.html">Assignments</a></li><li class="breadcrumb-item"><a href="../assignments/10_problem_set.html">Problem Set 10</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/problem-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem set instructions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/01_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/02_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/03_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/04_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/05_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/06_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/07_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/08_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/09_problem_set.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/10_problem_set.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Problem Set 10</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#problem-set-instructions" id="toc-problem-set-instructions" class="nav-link active" data-scroll-target="#problem-set-instructions">Problem Set Instructions</a></li>
  <li><a href="#question-1-30-points" id="toc-question-1-30-points" class="nav-link" data-scroll-target="#question-1-30-points">Question 1 (30 points)</a></li>
  <li><a href="#question-2-30-points" id="toc-question-2-30-points" class="nav-link" data-scroll-target="#question-2-30-points">Question 2 (30 points)</a></li>
  <li><a href="#question-3-40-points" id="toc-question-3-40-points" class="nav-link" data-scroll-target="#question-3-40-points">Question 3 (40 points)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Gov 2002: Problem Set 10</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 30, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><a href="../assignments/problem-sets.html">Submission instructions</a> | <a href="../files/assignments/pset_10.pdf">PDF <i class="fa-regular fa-file-pdf" aria-label="file-pdf"></i></a> | <a href="../files/assignments/pset_10.Rmd">Rmd <i class="fa-regular fa-file-code" aria-label="file-code"></i></a> |</p>
<section id="problem-set-instructions" class="level2">
<h2 class="anchored" data-anchor-id="problem-set-instructions">Problem Set Instructions</h2>
<p>This problem set is due on <strong>December 6, 11:59 pm</strong> Eastern time. Please upload a PDF of your solutions to Gradescope. We will accept hand-written solutions but we strongly advise you to typeset your answers in Rmarkdown. Please list the names of other students you worked with on this problem set.</p>
</section>
<section id="question-1-30-points" class="level2">
<h2 class="anchored" data-anchor-id="question-1-30-points">Question 1 (30 points)</h2>
<p>Public outrage about CEO pay finds its roots during the onset of the Great Recession. In this problem, we examine beliefs about CEO compensation. To begin, download <code>CEO.csv</code> from Ed and load it. The data came from a survey of 632 Americans. They were asked questions on how much they thought CEOs do and should earn. (The variables are called <code>perceived</code> and <code>ideal</code>, respectively).</p>
<ol type="a">
<li><p>To begin, produce a scatterplot with perceived CEO earnings among Americans on the x-axis and their ideal earnings on the y-axis. Estimate a least squares regression of ideal earnings on perceived earnings and report your results (coefficients and standard errors) in a neatly formatted table. ( Consider using <code>lm</code> and <code>stargazer</code>. The latter requires the <code>stargazer</code> package and you can install it by typing <code>install.packages("stargazer")</code>. (Of course, you are free to use other packages.) For running regression models and generating scatterplots, you may find the following slides helpful as well: <a href="https://gov50-f23.github.io/slides/16_multiple_regression_handout.pdf"><strong>1. Regression</strong></a>; <a href="https://gov50-f23.github.io/slides/03_data_viz_handout.pdf"><strong>2. Scatterplot</strong></a>.)</p></li>
<li><p>A common way of checking for non-linearity is to examine a plot in which the fitted values from a regression are plotted on the x-axis and the residuals from the regression are plotted on the y-axis (often called a <em>residuals versus fitted-values plot</em>). We can get the fitted values from a regression using the <code>fitted()</code> function and the residuals using the <code>residuals()</code> function. Intuitively, if linearity holds we would expect the residuals to be positive and negative in equal proportions at all points along the regression line. By plotting the residuals against the fitted values, we can see whether there are regions of the regression line where the residuals tend to be systematically positive or negative. Create a plot like this and interpret it. Based on this method, does there seem to be substantial non-linearity? If so, how would you correct it?</p></li>
<li><p>Now we are going to introduce a second regressor. Estimate a linear model predicting ideal CEO salary using both <code>perceived</code> CEO salary and <code>age</code>. Report the coefficients and standard errors in a neatly formatted table. Explain how the coefficients on <code>perceived</code> CEO salary changed after including the <code>age</code> variable.</p></li>
</ol>
</section>
<section id="question-2-30-points" class="level2">
<h2 class="anchored" data-anchor-id="question-2-30-points">Question 2 (30 points)</h2>
<p>Consider the following multivariate regression:</p>
<p><span class="math display">\[
Y = X\beta + Z\gamma + \epsilon
\]</span></p>
<ol type="a">
<li><p>Show that for any <span class="math inline">\(\{X, Z\}\)</span>, we can decompose <span class="math inline">\(Z\)</span> into <span class="math inline">\(P_X Z + M_X Z\)</span>, where <span class="math inline">\(P_X\)</span> and <span class="math inline">\(M_X\)</span> are the projection matrix and annihilator matrix of <span class="math inline">\(X\)</span> respectively. (<strong>Hint</strong>: Apply the definitions of the projection and annihilator matrices.) Also show that <span class="math inline">\(P_X\)</span> and <span class="math inline">\(M_X\)</span> are orthogonal. (<strong>Hint</strong>: Show that <span class="math inline">\(P_X^T M_X = 0\)</span>.)</p></li>
<li><p>Show that if <span class="math inline">\(X \perp Z\)</span>, then the coefficients we get from regressing <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> on <span class="math inline">\(Z\)</span> will be the same coefficients from the joint regression above. (<strong>Hint</strong>: One way to work on this problem is to notice that <span class="math inline">\(Y = X\beta + Z\gamma + \epsilon\)</span>, and thus <span class="math inline">\(Cov(Y, X) = Cov(X\beta + Z\gamma + \epsilon, X)\)</span>.)</p></li>
<li><p>Suppose <span class="math inline">\(\hat \beta\)</span> and <span class="math inline">\(\hat \gamma\)</span> are the OLS estimators for <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> for the regression above. Find a <span class="math inline">\(\hat \beta'\)</span> such that: <span class="math display">\[
\hat Y = X\hat \beta' + (M_X Z)\hat\gamma
\]</span> Write <span class="math inline">\(\hat \beta'\)</span> in terms of <span class="math inline">\(\hat \beta\)</span> and <span class="math inline">\(\hat \gamma\)</span>, and provide a substantive interpretation of <span class="math inline">\(\hat \beta'\)</span> in plain English (<strong>Hint</strong>: <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span> are not necessarily orthogonal anymore. Use results from part (a). ).</p></li>
<li><p>Lastly, show that the following regression <span class="math display">\[
M_X \hat Y = (M_X Z)  \hat \gamma
\]</span> will return the same OLS estimator <span class="math inline">\(\hat \gamma\)</span> as in the multivariate regression <span class="math inline">\(Y = X\beta + Z\gamma + \epsilon\)</span>, explain this result in plain English.</p></li>
</ol>
</section>
<section id="question-3-40-points" class="level2">
<h2 class="anchored" data-anchor-id="question-3-40-points">Question 3 (40 points)</h2>
<p>The standard output from OLS will give the standard errors for the estimated coefficients, but often we want to obtain measures of uncertainty for the predicted value of <span class="math inline">\(Y_i\)</span> given some value of <span class="math inline">\(X_i\)</span> (that is, the conditional expectation function). Using the example from lecture, we might be interested in the average wait times to vote for individuals making $25,000, $50,000, or $100,000 in annual income, along with measures of uncertainty around those estimates. In this problem we will look at how to calculate interval estimates for these predicted values. Assume the following <em>true</em> population model for <span class="math inline">\(Y_i|X_i\)</span>:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X_i + u_i,
\]</span></p>
<p>where the <span class="math inline">\(X_i\)</span> are random variables and <span class="math inline">\(u_i\)</span> are i.i.d. random variables with <span class="math inline">\(E[u_i\mid X_i] = 0\)</span> and <span class="math inline">\(Var(u_i\mid X_i) = \sigma^2\)</span>. Suppose we observe a random sample of <span class="math inline">\(n\)</span> paired observations <span class="math inline">\(\{Y_i, X_i\}\)</span>. Assume the Gauss-Markov assumptions hold and that we have a large sample. Our goal is to estimate the predicted value at some value <span class="math inline">\(X_i = x\)</span>:</p>
<p><span class="math display">\[\mu(x) = E[Y_i \mid X_i = x] = \beta_0 + \beta_1 x.\]</span></p>
<ol type="a">
<li><p>Let <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> be OLS estimators of the regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>. Use what you know about the unbiasedness of OLS estimates to show that <span class="math inline">\(\widehat{\mu}(x) = \hat{\beta_0} + \hat{\beta_1}x\)</span> is an unbiased estimator of the population quantity <span class="math inline">\(\mu(x) = E[Y_i\mid X_i = x]\)</span>.</p></li>
<li><p>Find the conditional variance of <span class="math inline">\(\hat{\beta_0}\)</span>, <span class="math inline">\(Var(\hat{\beta_0} \mid X_1, \ldots, X_n)\)</span>, using the following two facts. You answer should be in terms of <span class="math inline">\(\sigma^2\)</span> and functions of <span class="math inline">\(X_i\)</span>.</p></li>
</ol>
<p><span class="math display">\[
Cov(\overline{Y}, \hat{\beta}_1 \mid X_1, \ldots, X_n) = 0 \quad \text{and} \quad Var(\hat{\beta}_1 \mid X_1, \ldots, X_n) = \frac{\sigma^2}{\sum_{i=1}^n (X_i - \overline{X})^2}.
\]</span></p>
<ol start="3" type="a">
<li><p>Find the covariance of the OLS estimates given our <span class="math inline">\(X\)</span> values, <span class="math inline">\(Cov(\hat{\beta_0}, \hat{\beta_1}|X_1, \dotsc, X_n)\)</span>, again in terms of <span class="math inline">\(\sigma^2\)</span> and functions of the <span class="math inline">\(X_i\)</span>. (<strong>Hint</strong>: It’s not zero.)</p></li>
<li><p>Using what you found in (b) and (c), find the standard error of <span class="math inline">\(\widehat{\mu}(x) = \widehat{\beta}_0 + \widehat{\beta}_1x\)</span>.</p></li>
<li><p>Assume that we don’t know <span class="math inline">\(\sigma^2\)</span> and instead construct our estimate of the standard error by plugging in for <span class="math inline">\(\sigma^2\)</span> our unbiased estimate <span class="math inline">\(s^2\)</span> using the residuals.</p></li>
</ol>
<p>Give the formula for a large-sample <span class="math inline">\(95\%\)</span> confidence interval estimator for <span class="math inline">\(\mu(x) = E[Y \mid X = x]\)</span> using what you found above and substituting <span class="math inline">\(s^2\)</span> for <span class="math inline">\(\sigma^2\)</span>. How do we interpret this confidence interval?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>